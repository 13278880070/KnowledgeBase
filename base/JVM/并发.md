## java 内存模型

java 内存模型规定所有变量（线程私有的方法参数和局部变量除外）都存储在主存内，每条线程还有自己的工作内存，线程的工作内存中保存着该线程使用的变量在主存中的副本拷贝，线程对变量的所有操作必须在主存中进行，而不能直接读取主存中的变量。不同的线程之间也无法直接获取对方工作内存中的变量，线程间变量值的传递均要通过主内存来完成。

## volatile

volatile 的两个特性：

1. 保证 volatile 修饰的变量对所有线程的可见性（当一条线程修改了变量的值，对于其他线程来说是立即可见的）。

2. 禁止指令重排。

   原理：将代码生成汇编代码，有volatile修饰的变量，赋值后多执行了一个 `lock addl $0x0`操作，这个操作相当于一个内存屏障（Memory Barrier 或 Menory Dence，指重排序时不能把后面的指令冲排序到内存屏障之前的位置），当lock指令把修改同步到内存时，意味着所有之前的操作都已经执行完成，这样便形成了指令重排序无法越过内存屏障的效果。1
