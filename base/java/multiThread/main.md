# 了解多线程的主要组成部分

 在深入的了解多线程编程之前，非常有必要理清多线程变成有哪些基本的组成部分，和概念。

## java 线程模型

java 通过利用线程使得整个环境能够异步执行，有助于通过防止浪费CPU时钟资源来提高效率。

通过与单线程比较，可以更好地理解多线程环境的价值。单线程系统使用一种称为***轮询事件循环***的方法，在这种模型中，单个线程在一个无限循环中控制运行，轮询一个时间队列以决定下一步做什么。一旦轮询返回一个信号，时间循环就将控制调度至适当的事件处理程序。在这个时间处理程序返回之前，程序不能执行任何其他工作，这浪费了CPU执行时间，并且会导致程序的一部分支配着系统而阻止其他部分进行处理。通常，在单线程环境中，当线程因为等待某些资源而阻塞时，整个程序会停止运行。

多线程的优点是消除了***主循环/轮询***机制。可以暂停一个线程而不会停止程序的其他部分。当java程序中的线程阻塞的时候，只有被阻塞的线程会暂停，所有其他线仍将继续执行。

## 线程优先级

java为每个线程都指定了优先级，优先级决定了现代对于其他线程应当如何处理某个线程。线程优先级是一些整数，他们指定了一个线程相当于另一个线程的优先程度。优先级的绝对数值没有意义；如果只有一个线程在运行，优先级高的此线程不会比优先级低的线程运行快。反而，线程的优先级用于决定何时从一个运行的线程切换到下一个，这称为山下文切换。决定上下文切换发生时机的规则比较简单：

- 线程资源地放弃控制。线程显示地放弃控制权、休眠或在I/O之前阻塞，都会出现这种情况。在这种情况下，检查所有其他线程，并且准备运行的线程中优先级最高的那个线程会获得CPU资源

- 线程被优先级更高的线程取代。对于这种情况，没有放弃控制权的底优先级线程不管在作什么，都会被优先级更高的线程简单地取代。基本上，只要优先级高的线程希望运行，它就会取代底优先级线程，这称为抢占式多任务处理。



如果具有相同优先级的两个线程竞争CPU资源，这种情况有些复杂。对于Windows这类操作系统，优先级相等的线程以循环方式自动获得CPU资源。对于其他类型的操作系统，优先级相等的线程必须自愿地向其他线程放弃控制权，否则其他线程就不能运行。

## 同步

因为多线程为程序引入了异步的行为，所以必须提供一种在需要时强制同步的方法。例如在多线程操作数据的时候。为此，java以监视器这一年代久远的进程间同步模型为基础，实现了一种巧妙的方案。监视器最初是由C.A.R.Hoare 定义的一种控制机制，可以将监视器看做非常小的只能包含一个线程的盒子。一旦某个线程进入监视器，其他所有线程几必须等待，直到该线程退出监视器。通过这种方式，可以将监视器用于保护共享的资源，一防止多个线程同时对资源进行操作。

java没有提供“Monitor”类；相反，每个对象都有自己的隐式监视器。如果调用对象的同步方法，线程就会自动进入对象的隐式监视器。一旦某个线程位于一个同步方法中，其他线程就不能调用同一对象的的**任何其他同步方法**。因为语言背身内置了同步支持，所以可以编写出非常清晰并且简明的多线程代码。

## 消息传递

​	将程序分隔到独立的线程之后，需要定义他们之间的相互通信方式。当使用给某些其他语言编写程序的时候，必须依赖操作系统建立线程之间的通信。当然，这回增加系统的开销。相反，通过调用多有对象都具有的预先定义的方法，java 为两个或更多个线程之间的相互通信提供了一种简洁的低成本方式。java的消息传递系统允许某个线程进入对象的同步方法，然后进行等待，知道其他线程显式第通知这个线程停止等待继续执行为止。

## Thread类和Runnable接口

​	java的多线程系统是基于Thread类、Thread类的方法及其伴随接口Runnable而构架的。Thread类封装了线程的执行。因为不能直接引用正在运行的线程的细微状态，所以需要通过代理进行处理。Thread实例就是线程的代理。为了创建新线程，程序可以扩展Thread类或实现Runnable接口。

​					Thread类定义的一些方法

|   getName()   |          获取线程名称           |
| :-----------: | :-----------------------------: |
| getPriority() |        获取线程的优先级         |
|   isAlive()   |      确定线程是否仍在运行       |
|    join()     | 上下文中的线程等待调用线程终止  |
|     run()     |          线程的入口点           |
|    sleep()    |  挂起线程一段时间（不放弃锁）   |
|    start()    | 通过调用线程的run()方法启动线程 |



## 主线程

当java程序启动时，会立即开始运行一个线程，因为它是程序开始执行的线程，所以这个线程通常称为程序的主线程。主线程很重要，有一下两个原因：

- 其他子线程都是从主线程产生的
- 通常，主线程必须是最后才结束执行的线程，因为他要执行各种关闭动作。

主线程的名称为：main  优先级为：5

